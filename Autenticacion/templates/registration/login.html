
{% load static %}
{% load MensajesTags %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'Autenticacion/css/login.css' %}">

{% endblock %}
{% block content %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
</head>
<body style="background-image: url('{% static "Autenticacion/img/fondo2.jpg" %}');">
    <canvas id="mimapa" width="1920" height="1080"></canvas>

    <div class="container">
        <div class="login-card">
            <div class="card-header">
                <h2>Acceda a su cuenta</h2>
            </div>
            <div class="card-body">
                
                <form action="" method="post">
                    {% csrf_token %}
                    <div class="form-group">
                        <img src="{% static 'Autenticacion/img/logipuerto.png' %}" alt="Logo" class="logo">

                        <label for="username">Nombre de usuario</label>
                        <input type="text" name="username" id="username" class="form-control" 
                               placeholder="Ingresa tu nombre de usuario" required autofocus>
                    </div>
                    <div class="form-group">
                        <label for="password">Contraseña</label>
                        <input type="password" name="password" id="password" class="form-control" 
                               placeholder="Ingresa tu contraseña" required>
                    </div>
                    <button type="submit" class="btn">Acceder</button>

                    {% comment %} {% RenderMensajesDjango%} {% endcomment %}
                </form> 
                
                {% if form.errors %}
                <div class="alert alert-danger">
                    <ul>
                        {% for field, errors in form.errors.items %}
                            {% for error in errors %}
                                Nombre de usuario o contraseña incorrectos
                            {% endfor %}
                        {% endfor %}
                    </ul>
                </div>
                {%endif%}

                <div class="links">
                    <form action="{% url 'autenticacion:usuarios_password_reset' %}" method="post" class="password-reset-form">
                        {% csrf_token %}
                        <button type="submit" class="forgot-password-btn" aria-label="Recuperar contraseña">
                            <span>¿Olvidaste tu contraseña?</span>
                        </button>
                    </form>
                </div>

                <script>
                  const canvas = document.getElementById("mimapa");
                  const ctx = canvas.getContext("2d");
                  
                  // Dimensiones de diseño originales
                  const DESIGN_WIDTH = 1920;
                  const DESIGN_HEIGHT = 1080;
                  
                  // Coordenadas originales
                  const originalCoords = {
                      puertoA: { x: 422, y: 620 },
                      puertoGuayaquil: { x: 515, y: 715 },
                      puertoAguadulce: { x: 520, y: 688 },
                      puertoCentroAmerica: { x: 501, y: 665 },
                      puertoSaupe: { x: 665, y: 720 },
                      puertoBrazil: { x: 622, y: 820 },
                      puertoPlata: { x: 595, y: 838 },
                      puertoMadagascar: { x: 1240, y: 815 },

                      puertoConge: { x: 1121, y: 740 },
                      puertoOne: { x: 1245, y: 811 },
                      puertoAustralia: { x: 1587, y: 893 },
                      puertoNewZelanda: { x: 1592, y: 768 },
                      puertoIndonesia: { x: 1510, y: 695 },
                      puertoEuropaN: { x: 1143, y: 450 },
                      puertoChina: { x: 1504, y: 550 },
                      puertoNuevaGuinea: { x: 1461, y: 768 },
                  };
                  
                  console.log("Ancho de la página:", window.innerWidth, "px");
                  console.log("Alto de la página:", window.innerHeight, "px");

                  // Lista de rutas animadas con valores originales
                  const rutasOriginales = [
                      { origen: 'puertoA', destino: 'puertoGuayaquil', color: "#f2482a", altura: -25, grosor: 1, t: 0.5 },
                      //{ origen: 'puertoA', destino: 'puertoAguadulce', color: "#f39d13", altura: 55,  grosor: 2, t: 0.4 },
                      //{ origen: 'puertoA', destino: 'puertoCentroAmerica', color: "#fac495", altura: 80, grosor: 3, t: 0.1 },
                      { origen: 'puertoA', destino: 'puertoSaupe', color: "#f39d13", altura: -10, grosor: 1, t: 0.2 },
                      //{ origen: 'puertoA', destino: 'puertoBrazil', color: "#fac495", altura: 5, grosor: 1, t: 0.7 },
                      { origen: 'puertoA', destino: 'puertoPlata', color: "#f39d13", altura: -100, grosor: 2, t: 0.5 },
                      { origen: 'puertoA', destino: 'puertoMadagascar', color: "#f2482a", altura: -200, grosor: 2, t: 0.3 },
                      { origen: 'puertoA', destino: 'puertoConge', color: "#f39d13", altura: 100, grosor: 3, t: 0.1 },
                      { origen: 'puertoA', destino: 'puertoAustralia', color: "#fac495", altura: -380, grosor: 3, t: 0.3 },
                      { origen: 'puertoA', destino: 'puertoNewZelanda', color: "#f39d13", altura: -350, grosor: 2, t: 0.3 },                      
                      { origen: 'puertoA', destino: 'puertoIndonesia', color: "#f2482a", altura: 150, grosor: 3, t: 0.1 },
                      { origen: 'puertoA', destino: 'puertoEuropaN', color: "#f2482a", altura: 250, grosor: 3, t: 1 },
                      { origen: 'puertoA', destino: 'puertoChina', color: "#fac495", altura: 150, grosor: 3, t: 1 },
                      { origen: 'puertoA', destino: 'puertoNuevaGuinea', color: "#fac495", altura: -50, grosor: 2, t: 1 },

                  ];
                  
                  let rutas = [];
                  
                  // Función para ajustar el canvas al tamaño de la ventana
                  function ajustarCanvas() {
                      canvas.width = window.innerWidth;
                      canvas.height = window.innerHeight;
                      
                      // Recalcular las coordenadas escaladas
                      const escalaX = canvas.width / DESIGN_WIDTH;
                      const escalaY = canvas.height / DESIGN_HEIGHT;
                      
                      // Crear la versión escalada de las coordenadas
                      const coordsEscaladas = {};
                      for (const [puerto, coord] of Object.entries(originalCoords)) {
                          coordsEscaladas[puerto] = {
                              x: coord.x * escalaX,
                              y: coord.y * escalaY
                          };
                      }
                      
                      // Crear la versión escalada de las rutas
                      rutas = rutasOriginales.map(ruta => {
                          return {
                              origen: coordsEscaladas[ruta.origen],
                              destino: coordsEscaladas[ruta.destino],
                              color: ruta.color,
                              altura: ruta.altura * escalaY, // Escalar la altura según la escala vertical
                              grosor: Math.max(1, ruta.grosor * Math.min(escalaX, escalaY)), // Ajustar grosor mínimo
                              t: ruta.t
                          };
                      });
                  }
                  
                  // Función para obtener un punto en la curva bezier
                  function puntoEnCurva(t, p0, p1, altura) {
                      const c1 = { x: (p0.x + p1.x) / 2, y: p0.y - altura };
                      const c2 = { x: (p0.x + p1.x) / 2, y: p1.y - altura };
                      const x = Math.pow(1 - t, 3) * p0.x +
                                3 * Math.pow(1 - t, 2) * t * c1.x +
                                3 * (1 - t) * Math.pow(t, 2) * c2.x +
                                Math.pow(t, 3) * p1.x;
                      const y = Math.pow(1 - t, 3) * p0.y +
                                3 * Math.pow(1 - t, 2) * t * c1.y +
                                3 * (1 - t) * Math.pow(t, 2) * c2.y +
                                Math.pow(t, 3) * p1.y;
                      return { x, y };
                  }
                  
                  // Dibuja todas las trayectorias y partículas
                  function animar() {
                      ctx.clearRect(0, 0, canvas.width, canvas.height);
                  
                      rutas.forEach(ruta => {
                          // Dibuja la curva
                          ctx.beginPath();
                          ctx.moveTo(ruta.origen.x, ruta.origen.y);
                          const control1 = { x: (ruta.origen.x + ruta.destino.x) / 2, y: ruta.origen.y - ruta.altura };
                          const control2 = { x: (ruta.origen.x + ruta.destino.x) / 2, y: ruta.destino.y - ruta.altura };
                          ctx.bezierCurveTo(control1.x, control1.y, control2.x, control2.y, ruta.destino.x, ruta.destino.y);
                          ctx.strokeStyle = ruta.color;
                          ctx.lineWidth = ruta.grosor;
                          ctx.shadowColor = ruta.color;
                          ctx.shadowBlur = 8;
                          ctx.stroke();
                    
                          // Dibuja el punto animado
                          const punto = puntoEnCurva(ruta.t, ruta.destino,ruta.origen, ruta.altura);
                          ctx.beginPath();
                          ctx.arc(punto.x, punto.y, 4, 0, Math.PI * 2);
                          ctx.fillStyle = ruta.color;
                          ctx.shadowColor = ruta.color;
                          ctx.shadowBlur = 10;
                          ctx.fill();
                    
                          // Avanza el tiempo
                          ruta.t += 0.004;
                          if (ruta.t > 1) ruta.t = 0;
                      });
                    
                      requestAnimationFrame(animar);
                  }
                  
                  // Inicializar y manejar redimensionamiento
                  window.addEventListener('resize', ajustarCanvas);
                  ajustarCanvas(); // Configuración inicial
                  animar(); // Iniciar la animación


                  function actualizarFondo() {
                    const mimapa = document.getElementById('mimapa');
                    const ancho = window.innerWidth;
                    const alto = window.innerHeight;
                    const aspectRatio = ancho / alto;
                    const originalRatio = 2.03;
                    const tolerancia = 0.3;
                
                    const diferencia = Math.abs(aspectRatio - originalRatio);
                
                    if (diferencia > tolerancia) {
                      mimapa.classList.add('oculto');
                    } else {
                      mimapa.classList.remove('oculto');
                    }
                  }
                
                  // Ejecutar al cargar y al redimensionar
                  window.addEventListener('load', actualizarFondo);
                  window.addEventListener('resize', actualizarFondo);
              </script> 
                  
            </div>
        </div>
    </div>
</body>
    {% block ExtrasJS %}
        <script>
            var mensaje = "{{ mensaje }}";
        </script>
        <script src="{% static 'Core/js/sweetalert2.all.min.js' %}"></script>
        <script src="{% static 'Core/js/SweetAlert2.js' %}"></script>
    {% endblock ExtrasJS %}
{% endblock %}
