{% extends 'Core/base.html' %}

{% load static %}
{% load MensajesTags %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'Clientes/css/ClientePadre_detail.css' %}">
{% endblock %} 

{% block title %}Inicio{% endblock %}

{% block content %}
<div class="detail-container">
    <div class="container">
         {% comment %} <!-- Header con navegación -->
        <div class="detail-header">
            <div class="breadcrumb">
                <a href="#" class="breadcrumb-link">Usuarios</a>
                <span class="breadcrumb-separator">›</span>
                <span class="breadcrumb-current">Detalle</span>
            </div>
            <div class="header-actions">
                <a href="#" class="btn btn-secondary">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5M12 19l-7-7 7-7"/>
                    </svg>
                    Volver
                </a>
            </div>
        </div>   {% endcomment %}

        <!-- Tarjeta principal de detalle -->
        <div class="detail-card">
            <!-- Header de la tarjeta con avatar y estado -->
            <div class="card-header">
                <div class="user-avatar">
                    <div class="avatar-circle">
                        <span class="avatar-initials">{{clientePadre.razon_social |slice:":2"}}</span>
                    </div>
                    {% if clientePadre.user.is_active %}
                    <div class="status-indicator status-active"></div>
                    {%else%}
                    <div class="status-indicator status-blocked"></div>
                    {%endif%}
                </div>
                
                <div class="user-basic-info">
                    <h1 class="user-name">{{ clientePadre.razon_social }}</h1>
                    <p class="user-subtitle">{{ clientePadre.rfc }}</p>
                    {% if clientePadre.user.is_active %}
                        <div class="status-badge status-active">
                            <span class="status-dot"></span>
                            Usuario Activo
                        </div>
                    {% else %}
                        <div class="status-badge status-blocked">
                            <span class="status-dot-deactivate"></span>
                            Usuario Bloqueado
                        </div>
                    {% endif %}
                    
                </div>
                <div class="header-actions-card">
                    <button class="action-btn edit-btn" title="Editar usuario" onclick="window.location.href='{% url 'clientes:clientes_padre_editar' clientePadre.id %}'" >
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                        </svg>
                    </button>


                        <form method="post" action="{% url 'autenticacion:usuarios_bloquear' clientePadre.user.id  %}">
                            {% csrf_token %}
                            {% if clientePadre.user.is_active %}
                            <button type="submit" class="action-btn block-btn" title="Bloquear usuario">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                    <circle cx="12" cy="16" r="1"></circle>
                                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                                </svg>
                            </button>
                            {% else %}
                            <button type="submit" class="action-btn unlock-btn" title="Desbloquear usuario">
                                <i class="fa-solid fa-unlock"></i>
                            </button>
                            {%endif%}
                        </form>
                        
                        
                    <form method="post" action="{% url 'autenticacion:usuarios_eliminar' clientePadre.user.id %}" style="display: inline;">
                        {% csrf_token %}
                        <button type="submit" class="action-btn delete-btn" title="Eliminar usuario" onclick="return confirm('¿Estás seguro de eliminar este usuario?');">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="3,6 5,6 21,6"></polyline>
                            <path d="M19,6v14a2,2,0,0,1-2,2H7a2,2,0,0,1-2-2V6m3,0V4a2,2,0,0,1,2-2h4a2,2,0,0,1,2,2V6"></path>
                            <line x1="10" y1="11" x2="10" y2="17"></line>
                            <line x1="14" y1="11" x2="14" y2="17"></line>
                            </svg>
                        </button>
                    </form>
                </div>
            </div>

            <!-- Contenido principal -->
            <div class="card-content">
                <!-- Información básica -->
                <div class="info-section">
                    <h2 class="section-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                        Información General
                    </h2>
                    <div class="info-grid">
                        <div class="info-item">
                            <label class="info-label">Nombre de Usuario</label>
                            <div class="info-value">{{clientePadre.user.username}}</div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">Email</label>
                            <div class="info-value">{{clientePadre.user.email}}</div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">Razón Social</label>
                            <div class="info-value">{{clientePadre.razon_social}}</div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">RFC</label>
                            <div class="info-value rfc-value">{{clientePadre.rfc}}</div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">Tipo RFC:</label>
                            <div class="info-value">{{clientePadre.get_tipo_rfc_display}}</div>
                        </div>

                        <div class="info-item">
                            <label class="info-label">Regimen Fiscal:</label>
                            <div class="info-value">{{clientePadre.regimen_fiscal}}</div>
                        </div>

                        <div class="info-item">
                            <label class="info-label">uso de CFDI:</label>
                            <div class="info-value">{{clientePadre.usoCFDI}}</div>
                        </div>
                         
                        <div class="info-item">
                            <label class="info-label">Servicios</label>
                            {% for servicio in clientePadre.servicios.all %}
                            <div class="info-value"> - {{ servicio.servicio}}</div>
                            {% endfor %}

                        </div>

                        <div class="info-item">
                            <label class="info-label">Usuarios Hijo</label>
                            <div class="info-value">{{cantidad_hijos}}</div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">Referencia</label>
                            <div class="info-value">{{ clientePadre.referencia|default:"Sin referencia"  }}</div>
                        </div>

                    </div>
                </div>

                <!-- Información de ubicación -->
                <div class="info-section">
                    <h2 class="section-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                            <circle cx="12" cy="10" r="3"></circle>
                        </svg>
                        Ubicación
                    </h2>
                    <div class="info-grid">
                        <div class="info-item">
                            <label class="info-label">País</label>
                            <div class="info-value">
                                {{clientePadre.pais.name}}
                            </div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">Estado</label>
                            <div class="info-value">{{clientePadre.estado}}</div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">Ciudad</label>
                            <div class="info-value">{{clientePadre.ciudad}}</div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">Colonia</label>
                            <div class="info-value">{{clientePadre.colonia}}</div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">Codigo Postal</label>
                            <div class="info-value">{{clientePadre.codigo_postal}}</div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">Calle y numero</label>
                            <div class="info-value">{{clientePadre.calle}} #{{clientePadre.numero_exterior}}</div>
                        </div>
                    </div>
                </div>

                <!-- Información de contacto -->
                <div class="info-section">
                    <h2 class="section-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                        </svg>
                        Contacto
                    </h2>
                    <div class="info-grid">
                        <div class="info-item">
                            <label class="info-label">Nombre</label>
                            <div class="info-value">{{ contacto.nombre }}</div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">Teléfono Principal</label>
                            <div class="info-value">{{ contacto.telefono }}</div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">Movil</label>
                            <div class="info-value text-muted">{{ contacto.movil }}</div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">Correo</label>
                            <div class="info-value">
                                <a href="https://mail.google.com/mail/u/0/?tab=rm&ogbl#inbox?compose=new&to=" class="link">{{ contacto.correo }}</a>
                            </div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">Notas</label>
                            <div class="info-value">
                                <span class="company-type-badge">{{ contacto.notas }}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h2 class="section-title">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <path d="M10 11v5"></path>
                            <path d="M14 11v5"></path>
                            <path d="M12 13v-1"></path>
                        </svg>
                        Documentos
                    </h2>
                    <div class="info-grid">
                        <div class="info-item">
                            <label class="info-label">Contrato</label>
                            <div class="info-value"><a href="{{ documentos.contrato.url }}" class="link"> Ver Documento De Contrato </a></div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">Constancia Fiscal</label>
                            <div class="info-value"><a href="{{ documentos.constancia_fiscal.url }}" class="link"> Ver Constancia Fiscal </a></div>
                        </div>
                        
                    </div>
                </div>

                <!-- Información del Sistema -->
                <div class="info-section">
                    <h2 class="section-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                        </svg>
                        Información del Sistema
                    </h2>
                    <div class="info-grid">
                        <div class="info-item">
                            <label class="info-label">Fecha de Registro</label>
                            <div class="info-value">{{ clientePadre.fecha_creacion|date:"d/m/Y H:i" }}</div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">Último Acceso</label>
                            <div class="info-value">{{clientePadre.user.last_login}}</div>
                        </div>
                        {% comment %} <div class="info-item">
                            <label class="info-label">Estado de Verificación</label>
                            <div class="info-value">
                                <span class="verification-badge verified">Verificado</span>
                            </div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">Permisos</label>
                            <div class="info-value">
                                <span class="permission-badge">Usuario Estándar</span>
                            </div>
                        </div> {% endcomment %}
                    </div>
                </div>

                <div class="info-section">
                    <h2 class="section-title">
                        <i class="fas fa-user-friends"></i>

                        Clientes Hijos
                    </h2>

                    
                    <div class="info-grid">
                        {% for hijo in hijos %}
                            <div class="info-item">
                                <label class="info-label">Nombre de usuario:</label>
                                <div class="info-value">{{hijo.user.username }} </div>
                            </div>

                            <div class="info-item">
                                <label class="info-label">Creado el:</label>
                                <div class="info-value">{{hijo.fecha_creacion}} </div>
                            </div>

                            <div></div>
                        {% endfor %}
                    </div>
                </div>

            </div>

            <!-- Footer con acciones principales -->
            <div class="card-footer">
                <div class="footer-actions">
                    {% comment %} <button class="btn btn-secondary">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 3h18v18H3zM12 8v8m-4-4h8"/>
                        </svg>
                        Generar Reporte
                    </button> {% endcomment %}
                    <button class="btn btn-primary" onclick="window.location.href='{% url 'clientes:clientes_padre_editar' clientePadre.id %}'" >
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                        </svg>
                        Editar Usuario
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

{% RenderMensajesSweetAlert %}

{% block ExtrasJS %}
    <script>


        
        var mensaje = "{{ mensaje }}";
    </script>
    <script src="{% static 'Core/js/sweetalert2.all.min.js' %}"></script>
    <script src="{% static 'Core/js/SweetAlert2.js' %}"></script>
{% endblock ExtrasJS %}
{% endblock %}