{% extends 'Core/base.html' %}

{% load static %}
{% load MensajesTags %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'Clientes/css/ClientePadre_detail.css' %}">
{% endblock %}

{% block title %}Editar Cliente{% endblock %}

{% block content %}
<div class="detail-container">
    <div class="container">
        <div class="detail-card">
            <!-- Header de la tarjeta con avatar y estado -->
            <div class="card-header">
                <div class="user-avatar">
                    <div class="avatar-circle">
                        <span class="avatar-initials">{{ cliente.razon_social|slice:":2" }}</span>
                    </div>
                    {% if user.is_active %}
                    <div class="status-indicator status-active"></div>
                    {% else %}
                    <div class="status-indicator status-blocked"></div>
                    {% endif %}
                </div>

                <div class="user-basic-info">
                    <h1 class="user-name">Editar {{ cliente.razon_social }}</h1>
                    <p class="user-subtitle">{{ cliente.rfc }}</p>
                    {% if user.is_active %}
                        <div class="status-badge status-active">
                            <span class="status-dot"></span>
                            Usuario Activo
                        </div>
                    {% else %}
                        <div class="status-badge status-blocked">
                            <span class="status-dot-deactivate"></span>
                            Usuario Bloqueado
                        </div>
                    {% endif %}
                </div>
                <div class="header-actions-card">
                    <a href="{% url 'clientes:clientes_padre_detalle' cliente.pk %}" class="action-btn view-btn" title="Ver detalle"> 
                        <i class="fa-solid fa-eye"></i>                     
                    </a>

                    <form method="post" action="{% url 'autenticacion:usuarios_bloquear' user.id %}">
                        {% csrf_token %}
                        {% if user.is_active %}
                        <button type="submit" class="action-btn block-btn" title="Bloquear usuario">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                <circle cx="12" cy="16" r="1"></circle>
                                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                            </svg>
                        </button>
                        {% else %}
                        <button type="submit" class="action-btn unlock-btn" title="Desbloquear usuario">
                            <i class="fa-solid fa-unlock"></i>
                        </button>
                        {% endif %}
                    </form>
                </div> 
            </div>  

            <!-- Formulario de edición -->
            <form method="post" enctype="multipart/form-data" class="card-content">
                {% csrf_token %}

                <!-- Información básica -->
                <div class="info-section">
                    <h2 class="section-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                        Información General
                    </h2>
                    <div class="info-grid">
                        <div class="info-item">
                            <label class="info-label">Razón Social</label>
                            <div class="form-field">
                                {{ form1.razon_social }}
                                {% if form1.razon_social.errors %}
                                    <div class="form-error">{{ form1.razon_social.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">RFC</label>
                            <div class="form-field">
                                {{ form1.rfc }}
                                {% if form1.rfc.errors %}
                                    <div class="form-error">{{ form1.rfc.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">Tipo RFC</label>
                            <div class="form-field">
                                {{ form1.tipo_rfc }}
                                {% if form1.tipo_rfc.errors %}
                                    <div class="form-error">{{ form1.tipo_rfc.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">Regimen Fiscal</label>
                            <div class="form-field">
                                {{ form3.regimen_fiscal }}
                                {% if form3.regimen_fiscal.errors %}
                                    <div class="form-error">{{ form3.regimen_fiscal.errors }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="info-item">
                            <label class="info-label">Uso de CFDI</label>
                            <div class="form-field">
                                {{ form3.usoCFDI }}
                                {% if form3.usoCFDI.errors %}
                                    <div class="form-error">{{ form3.usoCFDI.errors }}</div>
                                {% endif %}
                            </div>
                        </div>                        

                        <div class="info-item">
                            <label class="info-label">Servicios</label>
                            <div class="form-field">
                                {{ form3.servicios }}
                                {% if form3.servicios.errors %}
                                    <div class="form-error">{{ form3.servicios.errors }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="info-item">
                            <label class="info-label">Referencia</label>
                            <div class="form-field">
                                {{ form3.referencia }}
                                {% if form3.referencia.errors %}
                                    <div class="form-error">{{ form3.referencia.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Información de ubicación -->
                <div class="info-section">
                    <h2 class="section-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                            <circle cx="12" cy="10" r="3"></circle>
                        </svg>
                        Ubicación
                    </h2>
                    <div class="info-grid">
                        <div class="info-item">
                            <label class="info-label">País</label>
                            <div class="form-field">
                                {{ form2.pais }}
                                {% if form2.pais.errors %}
                                    <div class="form-error">{{ form2.pais.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">Estado</label>
                            <div class="form-field">
                                {{ form2.estado }}
                                {% if form2.estado.errors %}
                                    <div class="form-error">{{ form2.estado.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">Ciudad</label>
                            <div class="form-field">
                                {{ form2.ciudad }}
                                {% if form2.ciudad.errors %}
                                    <div class="form-error">{{ form2.ciudad.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">Colonia</label>
                            <div class="form-field">
                                {{ form2.colonia }}
                                {% if form2.colonia.errors %}
                                    <div class="form-error">{{ form2.colonia.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">Código Postal</label>
                            <div class="form-field">
                                {{ form2.codigo_postal }}
                                {% if form2.codigo_postal.errors %}
                                    <div class="form-error">{{ form2.codigo_postal.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">Calle y número</label>
                            <div class="form-field">
                                <div class="address-fields">
                                    {{ form2.calle }}
                                    {{ form2.numero_exterior }}
                                    {% if form2.numero_interior %}
                                        {{ form2.numero_interior }}
                                    {% endif %}
                                </div>
                                {% if form2.calle.errors or form2.numero_exterior.errors %}
                                    <div class="form-error">
                                        {{ form2.calle.errors }}
                                        {{ form2.numero_exterior.errors }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Información de contacto -->
                <div class="info-section">
                    <h2 class="section-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                        </svg>
                        Contacto
                    </h2>
                    <div class="info-grid">
                        <div class="info-item">
                            <label class="info-label">Nombre</label>
                            <div class="form-field">
                                {{ contacto_form.nombre }}
                                {% if contacto_form.nombre.errors %}
                                    <div class="form-error">{{ contacto_form.nombre.errors }}</div>
                                {% endif %}
                            </div>
                            <label class="info-label">Teléfono Principal</label>
                            <div class="form-field">
                                {{ contacto_form.telefono }}
                                {% if contacto_form.telefono.errors %}
                                    <div class="form-error">{{ contacto_form.telefono.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">Móvil</label>
                            <div class="form-field">
                                {{ contacto_form.movil }}
                                {% if contacto_form.movil.errors %}
                                    <div class="form-error">{{ contacto_form.movil.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">Correo</label>
                            <div class="form-field">
                                {{ contacto_form.correo }}
                                {% if contacto_form.correo.errors %}
                                    <div class="form-error">{{ contacto_form.correo.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">Notas</label>
                            <div class="form-field">
                                {{ contacto_form.notas }}
                                {% if contacto_form.notas.errors %}
                                    <div class="form-error">{{ contacto_form.notas.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Documentos -->
                <div class="info-section">
                    <h2 class="section-title">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <path d="M10 11v5"></path>
                            <path d="M14 11v5"></path>
                            <path d="M12 13v-1"></path>
                        </svg>
                        Documentos
                    </h2>
                    <div class="info-grid">
                        <div class="info-item">
                            <label class="info-label">Contrato</label>
                            <div class="form-field">
                                {{ documentos_form.contrato }}
                                {% if documentos_form.contrato.errors %}
                                    <div class="form-error">{{ documentos_form.contrato.errors }}</div>
                                {% endif %}
                                {% if documentos_form.instance.contrato %}
                                    <a href="{{ documentos.contrato.url }}" class="link" target="_blank">Ver documento actual</a>
                                {% endif %}
                            </div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">Constancia Fiscal</label>
                            <div class="form-field">
                                {{ documentos_form.constancia_fiscal }}
                                {% if documentos_form.constancia_fiscal.errors %}
                                <div class="form-error">{{ documentos_form.constancia_fiscal.errors }}</div>
                                {% endif %}
                               
                                <a href="{{ documentos.constancia_fiscal.url }}" class="link" target="_blank">Ver documento actual</a>
                                
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Footer con acciones -->
                <div class="card-footer">
                    <div class="footer-actions">
                        {% comment %} <a href="{% url 'clientes:detalle_ClientePadre' form.instance.user.id %}" class="btn btn-secondary"> {% endcomment %}
                            {% comment %} <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M19 12H5M12 19l-7-7 7-7"/>
                            </svg>
                            Cancelar
                        </a> {% endcomment %}
                        <button type="submit" class="btn btn-primary">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                                <polyline points="17 21 17 13 7 13 7 21"></polyline>
                                <polyline points="7 3 7 8 15 8"></polyline>
                            </svg>
                            Guardar Cambios
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

{% RenderMensajesSweetAlert %}

{% block ExtrasJS %}
    <script>
        var mensaje = "{{ mensaje }}";
    </script>
    <script src="{% static 'Core/js/sweetalert2.all.min.js' %}"></script>
    <script src="{% static 'Core/js/SweetAlert2.js' %}"></script>

    <script>
        // Script para mejorar la experiencia de usuario en el formulario
        document.addEventListener('DOMContentLoaded', function() {
            // Seleccionar todos los campos de formulario y añadir clases
            const inputs = document.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                input.classList.add('form-input');
                if (input.type !== 'file') {
                    input.classList.add('form-control');
                }
            });

            // Manejar el cambio de país para potencialmente cargar estados (si es necesario)
            const paisSelect = document.getElementById('id_pais');
            if (paisSelect) {
                paisSelect.addEventListener('change', function() {
                    // Aquí podrías añadir lógica para cargar estados dinámicamente
                });
            }
        });
    </script>
{% endblock ExtrasJS %}
{% endblock %}